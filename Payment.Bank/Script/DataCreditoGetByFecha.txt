
SELECT 'P' as Tipoentidad, Contratos.ContratoID, Contratos.Fecha, Contratos.Vence, Personas.FechaNacimiento, replace(Personas.Documento,'-','') as Documento, Personas.Nombres, Personas.Apellidos, CONCAT(Personas.Nombres, ' ', Personas.Apellidos) AS Cliente, Personas.Direccion, Personas.Correo, 
replace(replace(replace(replace(Personas.Telefono,'(',''),')',''),'-',''),'_','') as Telefono, replace(replace(replace(replace(Personas.Celular,'(',''),')',''),'-',''),'_','') as Celular, Ciudades.Ciudad, Provincias.Provincia, CASE WHEN Condiciones.CondicionID = 1 THEN 'MENSUAL' WHEN Condiciones.CondicionID = 2 THEN 'QUINCENAL' WHEN Condiciones.CondicionID = 3 THEN 'SEMANAL' ELSE 'DIARIO' END AS Condicion, TipoContratos.TipoContrato,  CASE WHEN Sexos.SexoID = 1 THEN 'M' ELSE 'F' END as Sexo, CASE WHEN Personas.EstadoCivilID = 1 then 'S' else 'C' end as EstadoCivil, Ocupaciones.Ocupacion, Solicitudes.ClienteID, Paises.Pais, Paises.Nacionalidad, Provincias.Provincia, Contratos.Interes, Solicitudes.Tiempo, Contratos.EstadoID,
round( Solicitudes.Monto +   Solicitudes.Monto * (((Contratos.Comision) / 100) ),0) AS Monto, Contratos.Cuota, Instituciones.Institucion, Instituciones.Direccion as DireccionInstitucion, Instituciones.Telefono as TelefonoInstitucion,

CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM  DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM  Cuotas AS c11 WHERE ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM  DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM  Cuotas AS c11 WHERE   ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN
(SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM  DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE  ContratoID = Contratos.ContratoID))) < 0 THEN 0
ELSE
(SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM  Cuotas AS c11 WHERE ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT  SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM  Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (ContratoID = Contratos.ContratoID)))), 0) AS Balance FROM  Cuotas AS C WHERE (ContratoID = Contratos.ContratoID)) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (ContratoID = Contratos.ContratoID)))), 0) AS Balance FROM Cuotas AS C WHERE (ContratoID = Contratos.ContratoID))
END as Balance,

CASE WHEN CASE WHEN ( SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) < 1 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) < 1 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (Vence <= @Hasta) AND (ContratoID = Contratos.ContratoID)))), 0) AS Balance FROM Cuotas AS C WHERE (ContratoID = Contratos.ContratoID)) < 1 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) < 1 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM  Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) < 1 THEN 0 ELSE  (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (Vence <= @Hasta) AND (ContratoID = Contratos.ContratoID)))), 0) AS Balance FROM Cuotas AS C WHERE (ContratoID = Contratos.ContratoID)) END < 1 THEN 0
ELSE
(SELECT COUNT(CuotaID) AS Cantidad FROM Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta) AND (Capital + Comision + Interes + Mora + Legal + Seguro + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID = C.CuotaID)) < 1 THEN 0 ELSE  (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID = C.CuotaID)) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaDebitos AS ND WHERE (CuotaID = C.CuotaID)) < 1 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID = C.CuotaID)) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (DR.CuotaID = C.CuotaID)), 0) > 1)) 
END AS Cantidad,
																 
								 
IFNULL(CASE WHEN
(SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (Vence <= @Hasta) AND (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta)) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (Vence <= @Hasta) AND (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta)) END, 0) 
AS Atraso,

CASE WHEN IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 0 AND 30)  AND ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 0 AND 30)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 0 AND 30)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 0 AND 30)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 0 AND 30)  AND  (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM  Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta)) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 0 AND 30)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 0 AND 30)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 0 AND 30)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 0 AND 30)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 0 AND 30)  AND (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta) AND (DATEDIFF(Vence, @Hasta) * -1 BETWEEN 0 AND 30)) END, 0) < 0 THEN 0 ELSE IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 0 AND 30)  AND ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 0 AND 30)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 0 AND 30)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 0 AND 30)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 0 AND 30)  AND  (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM  Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta)) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 0 AND 30)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 0 AND 30)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 0 AND 30)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 0 AND 30)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 0 AND 30)  AND (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta) AND (DATEDIFF(Vence, @Hasta) * -1 BETWEEN 0 AND 30)) END, 0) END as ENTRE0Y30,
CASE WHEN IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 31 AND 60)  AND ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 31 AND 60)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 31 AND 60)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 31 AND 60)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 31 AND 60)  AND  (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM  Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta)) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 31 AND 60)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 31 AND 60)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 31 AND 60)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 31 AND 60)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 31 AND 60)  AND (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta) AND (DATEDIFF(Vence, @Hasta) * -1 BETWEEN 31 AND 60)) END, 0) < 0 THEN 0 ELSE IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 31 AND 60)  AND ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 31 AND 60)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 31 AND 60)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 31 AND 60)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 31 AND 60)  AND  (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM  Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta)) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 31 AND 60)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 31 AND 60)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 31 AND 60)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 31 AND 60)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 31 AND 60)  AND (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta) AND (DATEDIFF(Vence, @Hasta) * -1 BETWEEN 31 AND 60)) END, 0) END as ENTRE31Y60,
CASE WHEN IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 61 AND 90)  AND ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 61 AND 90)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 61 AND 90)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 61 AND 90)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 61 AND 90)  AND  (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM  Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta)) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 61 AND 90)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 61 AND 90)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 61 AND 90)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 61 AND 90)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 61 AND 90)  AND (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta) AND (DATEDIFF(Vence, @Hasta) * -1 BETWEEN 61 AND 90)) END, 0) < 0 THEN 0 ELSE IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 61 AND 90)  AND ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 61 AND 90)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 61 AND 90)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 61 AND 90)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 61 AND 90)  AND  (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM  Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta)) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 61 AND 90)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 61 AND 90)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 61 AND 90)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 61 AND 90)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 61 AND 90)  AND (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta) AND (DATEDIFF(Vence, @Hasta) * -1 BETWEEN 61 AND 90)) END, 0) END as ENTRE61Y90,
CASE WHEN IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 91 AND 120)  AND ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 91 AND 120)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 91 AND 120)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 91 AND 120)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 91 AND 120)  AND  (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM  Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta)) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 91 AND 120)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 91 AND 120)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 91 AND 120)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 91 AND 120)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 91 AND 120)  AND (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta) AND (DATEDIFF(Vence, @Hasta) * -1 BETWEEN 91 AND 120)) END, 0) < 0 THEN 0 ELSE IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 91 AND 120)  AND ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 91 AND 120)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 91 AND 120)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 91 AND 120)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 91 AND 120)  AND  (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM  Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta)) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 91 AND 120)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 91 AND 120)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 91 AND 120)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 91 AND 120)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 91 AND 120)  AND (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta) AND (DATEDIFF(Vence, @Hasta) * -1 BETWEEN 91 AND 120)) END, 0) END as ENTRE91Y120,
CASE WHEN IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 121 AND 150)  AND ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 121 AND 150)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 121 AND 150)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 121 AND 150)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 121 AND 150)  AND  (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM  Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta)) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 121 AND 150)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 121 AND 150)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 121 AND 150)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 121 AND 150)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 121 AND 150)  AND (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta) AND (DATEDIFF(Vence, @Hasta) * -1 BETWEEN 121 AND 150)) END, 0) < 0 THEN 0 ELSE IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 121 AND 150)  AND ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 121 AND 150)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 121 AND 150)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 121 AND 150)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 121 AND 150)  AND  (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM  Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta)) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 121 AND 150)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 121 AND 150)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 121 AND 150)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 121 AND 150)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 121 AND 150)  AND (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta) AND (DATEDIFF(Vence, @Hasta) * -1 BETWEEN 121 AND 150)) END, 0) END as ENTRE121Y150,
CASE WHEN IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 151 AND 180)  AND ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 151 AND 180)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 151 AND 180)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 151 AND 180)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 151 AND 180)  AND  (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM  Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta)) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 151 AND 180)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 151 AND 180)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 151 AND 180)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 151 AND 180)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 151 AND 180)  AND (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta) AND (DATEDIFF(Vence, @Hasta) * -1 BETWEEN 151 AND 180)) END, 0) < 0 THEN 0 ELSE IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 151 AND 180)  AND ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 151 AND 180)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 151 AND 180)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 151 AND 180)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 151 AND 180)  AND  (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM  Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta)) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 151 AND 180)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 151 AND 180)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 151 AND 180)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 151 AND 180)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 151 AND 180)  AND (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta) AND (DATEDIFF(Vence, @Hasta) * -1 BETWEEN 151 AND 180)) END, 0) END as ENTRE151Y180,
CASE WHEN IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 181 AND 210)  AND ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 181 AND 210)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 181 AND 210)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 181 AND 210)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 181 AND 210)  AND  (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM  Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta)) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 181 AND 210)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 181 AND 210)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 181 AND 210)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 181 AND 210)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 181 AND 210)  AND (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta) AND (DATEDIFF(Vence, @Hasta) * -1 BETWEEN 181 AND 210)) END, 0) < 0 THEN 0 ELSE IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 181 AND 210)  AND ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 181 AND 210)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 181 AND 210)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 181 AND 210)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 181 AND 210)  AND  (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM  Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta)) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 181 AND 210)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 181 AND 210)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 181 AND 210)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 181 AND 210)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 181 AND 210)  AND (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta) AND (DATEDIFF(Vence, @Hasta) * -1 BETWEEN 181 AND 210)) END, 0) END as ENTRE181Y210,
CASE WHEN IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 211 AND 240)  AND ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 211 AND 240)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 211 AND 240)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 211 AND 240)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 211 AND 240)  AND  (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM  Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta)) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 211 AND 240)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 211 AND 240)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 211 AND 240)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 211 AND 240)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 211 AND 240)  AND (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta) AND (DATEDIFF(Vence, @Hasta) * -1 BETWEEN 211 AND 240)) END, 0) < 0 THEN 0 ELSE IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 211 AND 240)  AND ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 211 AND 240)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 211 AND 240)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 211 AND 240)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 211 AND 240)  AND  (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM  Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta)) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 211 AND 240)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 211 AND 240)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 211 AND 240)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 211 AND 240)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 211 AND 240)  AND (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta) AND (DATEDIFF(Vence, @Hasta) * -1 BETWEEN 211 AND 240)) END, 0) END as ENTRE211Y240,
CASE WHEN IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 241 AND 270)  AND ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 241 AND 270)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 241 AND 270)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 241 AND 270)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 241 AND 270)  AND  (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM  Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta)) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 241 AND 270)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 241 AND 270)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 241 AND 270)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 241 AND 270)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 241 AND 270)  AND (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta) AND (DATEDIFF(Vence, @Hasta) * -1 BETWEEN 241 AND 270)) END, 0) < 0 THEN 0 ELSE IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 241 AND 270)  AND ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 241 AND 270)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 241 AND 270)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 241 AND 270)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 241 AND 270)  AND  (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM  Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta)) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 241 AND 270)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 241 AND 270)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 241 AND 270)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 241 AND 270)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 241 AND 270)  AND (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta) AND (DATEDIFF(Vence, @Hasta) * -1 BETWEEN 241 AND 270)) END, 0) END as ENTRE241Y270,
CASE WHEN IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 > 270)  AND ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 > 270)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 > 270)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 > 270)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 > 270)  AND  (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM  Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta)) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 > 270)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 > 270)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 > 270)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 > 270)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 > 270)  AND (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta) AND (DATEDIFF(Vence, @Hasta) * -1 > 270)) END, 0) < 0 THEN 0 ELSE IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 > 270)  AND ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 > 270)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 > 270)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 > 270)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 > 270)  AND  (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM  Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta)) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 > 270)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 > 270)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 > 270)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 > 270)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 > 270)  AND (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta) AND (DATEDIFF(Vence, @Hasta) * -1 > 270)) END, 0) END as MAS270,




		
CASE WHEN Solicitudes.Monto + Solicitudes.Monto * Contratos.Comision / 100 * Solicitudes.Tiempo  + (Solicitudes.Monto * Contratos.Interes / 100 * Solicitudes.Tiempo) >	IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.ContratoID = Contratos.ContratoID)), 0) THEN IFNULL((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.ContratoID = Contratos.ContratoID)), 0)								 
ELSE
Solicitudes.Monto + Solicitudes.Monto * Contratos.Comision / 100 * Solicitudes.Tiempo  + (Solicitudes.Monto * Contratos.Interes / 100 * Solicitudes.Tiempo) 					 
END AS Pagado,

(SELECT Fecha FROM Recibos AS R WHERE (ContratoID = Contratos.ContratoID) AND (EstadoID = 1) ORDER BY ReciboID DESC Limit 1) AS FechaUltimoPago,
(SELECT Monto FROM Recibos AS R WHERE (ContratoID = Contratos.ContratoID) AND (EstadoID = 1) ORDER BY ReciboID DESC Limit 1) AS MontoUltimoPago,			   

1 AS Deudor, 
CASE WHEN Solicitudes.TipoSolicitudID = 2 THEN 'H' WHEN Solicitudes.TipoSolicitudID = 4 THEN 'C' WHEN Solicitudes.TipoSolicitudID = 5 THEN 'M' ELSE 'N' END AS Tipo,

CASE
WHEN CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM  DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM  Cuotas AS c11 WHERE ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM  DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM  Cuotas AS c11 WHERE   ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM  DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM  Cuotas AS c11 WHERE ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT  SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM  Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (ContratoID = Contratos.ContratoID)))), 0) AS Balance FROM  Cuotas AS C WHERE (ContratoID = Contratos.ContratoID)) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (ContratoID = Contratos.ContratoID)))), 0) AS Balance FROM Cuotas AS C WHERE (ContratoID = Contratos.ContratoID)) END <= 10 THEN 'S' 
WHEN CASE WHEN CASE WHEN ( SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) < 1 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) < 1 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (Vence <= @Hasta) AND (ContratoID = Contratos.ContratoID)))), 0) AS Balance FROM Cuotas AS C WHERE (ContratoID = Contratos.ContratoID)) < 1 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) < 1 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM  Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) < 1 THEN 0 ELSE  (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (Vence <= @Hasta) AND (ContratoID = Contratos.ContratoID)))), 0) AS Balance FROM Cuotas AS C WHERE (ContratoID = Contratos.ContratoID)) END < 1 THEN 0 ELSE (SELECT COUNT(CuotaID) AS Cantidad FROM Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta) AND (Capital + Comision + Interes + Mora + Legal + Seguro + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID = C.CuotaID)) < 1 THEN 0 ELSE  (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID = C.CuotaID)) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaDebitos AS ND WHERE (CuotaID = C.CuotaID)) < 1 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID = C.CuotaID)) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (DR.CuotaID = C.CuotaID)), 0) > 1)) END < 1 THEN 'N'
WHEN CASE WHEN CASE WHEN ( SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) < 1 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) < 1 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (Vence <= @Hasta) AND (ContratoID = Contratos.ContratoID)))), 0) AS Balance FROM Cuotas AS C WHERE (ContratoID = Contratos.ContratoID)) < 1 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) < 1 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM  Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) < 1 THEN 0 ELSE  (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (Vence <= @Hasta) AND (ContratoID = Contratos.ContratoID)))), 0) AS Balance FROM Cuotas AS C WHERE (ContratoID = Contratos.ContratoID)) END < 1 THEN 0 ELSE (SELECT COUNT(CuotaID) AS Cantidad FROM Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta) AND (Capital + Comision + Interes + Mora + Legal + Seguro + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID = C.CuotaID)) < 1 THEN 0 ELSE  (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID = C.CuotaID)) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaDebitos AS ND WHERE (CuotaID = C.CuotaID)) < 1 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID = C.CuotaID)) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (DR.CuotaID = C.CuotaID)), 0) > 1)) END <= 3 THEN 'M'
WHEN CASE WHEN CASE WHEN ( SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) < 1 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) < 1 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (Vence <= @Hasta) AND (ContratoID = Contratos.ContratoID)))), 0) AS Balance FROM Cuotas AS C WHERE (ContratoID = Contratos.ContratoID)) < 1 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) < 1 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM  Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) < 1 THEN 0 ELSE  (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (Vence <= @Hasta) AND (ContratoID = Contratos.ContratoID)))), 0) AS Balance FROM Cuotas AS C WHERE (ContratoID = Contratos.ContratoID)) END < 1 THEN 0 ELSE (SELECT COUNT(CuotaID) AS Cantidad FROM Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta) AND (Capital + Comision + Interes + Mora + Legal + Seguro + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID = C.CuotaID)) < 1 THEN 0 ELSE  (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID = C.CuotaID)) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaDebitos AS ND WHERE (CuotaID = C.CuotaID)) < 1 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID = C.CuotaID)) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (DR.CuotaID = C.CuotaID)), 0) > 1)) END <= 5 THEN 'L' ELSE 'C' END AS Status


FROM            Contratos INNER JOIN
                         Solicitudes ON Contratos.SolicitudID = Solicitudes.SolicitudID INNER JOIN
                         Clientes ON Solicitudes.ClienteID = Clientes.ClienteID INNER JOIN
                         Personas ON Clientes.Documento = Personas.Documento INNER JOIN
                         Condiciones ON Solicitudes.CondicionID = Condiciones.CondicionID INNER JOIN
                         Ciudades ON Ciudades.CiudadID = Personas.CiudadID INNER JOIN
                         Provincias ON Provincias.ProvinciaID = Ciudades.ProvinciaID INNER JOIN
						 Paises ON Provincias.PaisID = Paises.PaisID INNER JOIN
                         TipoContratos ON Contratos.TipoContratoID = TipoContratos.TipoContratoID INNER JOIN
                         Sucursales ON Clientes.SucursalID = Sucursales.SucursalID INNER JOIN 
                         Sexos ON Personas.SexoID = Sexos.SexoID INNER JOIN 
                         EstadosCiviles on Personas.EstadoCivilID = EstadosCiviles.EstadoCivilID LEFT OUTER JOIN
                         DatosEconomicos on Personas.Documento = DatosEconomicos.Documento INNER JOIN
                         Ocupaciones on DatosEconomicos.OcupacionID = Ocupaciones.OcupacionID INNER JOIN
                         Instituciones on DatosEconomicos.InstitucionID = Instituciones.InstitucionID INNER JOIN
                         Zonas on Contratos.ZonaID = Zonas.ZonaID
WHERE        (Contratos.EstadoID = 1) AND (Contratos.Fecha <= @Hasta) AND (Contratos.DataCredito = 1)

UNION ALL

SELECT 'P' as Tipoentidad, Contratos.ContratoID, Contratos.Fecha, Contratos.Vence, Personas.FechaNacimiento, Personas.Documento, Personas.Nombres, Personas.Apellidos, CONCAT(Personas.Nombres, ' ', Personas.Apellidos) AS Cliente, Personas.Direccion, Personas.Correo, 
Personas.Telefono, Personas.Celular, Ciudades.Ciudad, Provincias.Provincia, CASE WHEN Condiciones.CondicionID = 1 THEN 'MENSUAL' WHEN Condiciones.CondicionID = 2 THEN 'QUINCENAL' WHEN Condiciones.CondicionID = 3 THEN 'SEMANAL' ELSE 'DIARIO' END AS Condicion, TipoContratos.TipoContrato,  CASE WHEN Sexos.SexoID = 1 THEN 'M' ELSE 'F' END as Sexo, CASE WHEN Personas.EstadoCivilID = 1 then 'S' else 'C' end as EstadoCivil, Ocupaciones.Ocupacion, Solicitudes.ClienteID, Paises.Pais, Paises.Nacionalidad, Provincias.Provincia, Contratos.Interes, Solicitudes.Tiempo, Contratos.EstadoID,
round( Solicitudes.Monto +   Solicitudes.Monto * (((Contratos.Comision) / 100) * (Solicitudes.Tiempo / Condiciones.Meses)),0) AS Monto, Contratos.Cuota,  Instituciones.Institucion, Instituciones.Direccion as DireccionInstitucion, Instituciones.Telefono as TelefonoInstitucion,

CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM  DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM  Cuotas AS c11 WHERE ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM  DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM  Cuotas AS c11 WHERE   ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN
(SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM  DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE  ContratoID = Contratos.ContratoID))) < 0 THEN 0
ELSE
(SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM  Cuotas AS c11 WHERE ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT  SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM  Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (ContratoID = Contratos.ContratoID)))), 0) AS Balance FROM  Cuotas AS C WHERE (ContratoID = Contratos.ContratoID)) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (ContratoID = Contratos.ContratoID)))), 0) AS Balance FROM Cuotas AS C WHERE (ContratoID = Contratos.ContratoID))
END as Balance,

CASE WHEN CASE WHEN ( SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) < 1 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) < 1 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (Vence <= @Hasta) AND (ContratoID = Contratos.ContratoID)))), 0) AS Balance FROM Cuotas AS C WHERE (ContratoID = Contratos.ContratoID)) < 1 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) < 1 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM  Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) < 1 THEN 0 ELSE  (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (Vence <= @Hasta) AND (ContratoID = Contratos.ContratoID)))), 0) AS Balance FROM Cuotas AS C WHERE (ContratoID = Contratos.ContratoID)) END < 1 THEN 0
ELSE
(SELECT COUNT(CuotaID) AS Cantidad FROM Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta) AND (Capital + Comision + Interes + Mora + Legal + Seguro + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID = C.CuotaID)) < 1 THEN 0 ELSE  (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID = C.CuotaID)) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaDebitos AS ND WHERE (CuotaID = C.CuotaID)) < 1 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID = C.CuotaID)) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (DR.CuotaID = C.CuotaID)), 0) > 1)) 
END AS Cantidad,
																 
								 
IFNULL(CASE WHEN
(SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (Vence <= @Hasta) AND (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta)) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (Vence <= @Hasta) AND (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta)) END, 0) 
AS Atraso,

CASE WHEN IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 0 AND 30)  AND ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 0 AND 30)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 0 AND 30)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 0 AND 30)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 0 AND 30)  AND  (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM  Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta)) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 0 AND 30)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 0 AND 30)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 0 AND 30)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 0 AND 30)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 0 AND 30)  AND (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta) AND (DATEDIFF(Vence, @Hasta) * -1 BETWEEN 0 AND 30)) END, 0) < 0 THEN 0 ELSE IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 0 AND 30)  AND ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 0 AND 30)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 0 AND 30)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 0 AND 30)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 0 AND 30)  AND  (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM  Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta)) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 0 AND 30)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 0 AND 30)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 0 AND 30)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 0 AND 30)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 0 AND 30)  AND (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta) AND (DATEDIFF(Vence, @Hasta) * -1 BETWEEN 0 AND 30)) END, 0) END as ENTRE0Y30,
CASE WHEN IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 31 AND 60)  AND ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 31 AND 60)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 31 AND 60)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 31 AND 60)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 31 AND 60)  AND  (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM  Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta)) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 31 AND 60)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 31 AND 60)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 31 AND 60)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 31 AND 60)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 31 AND 60)  AND (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta) AND (DATEDIFF(Vence, @Hasta) * -1 BETWEEN 31 AND 60)) END, 0) < 0 THEN 0 ELSE IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 31 AND 60)  AND ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 31 AND 60)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 31 AND 60)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 31 AND 60)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 31 AND 60)  AND  (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM  Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta)) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 31 AND 60)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 31 AND 60)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 31 AND 60)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 31 AND 60)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 31 AND 60)  AND (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta) AND (DATEDIFF(Vence, @Hasta) * -1 BETWEEN 31 AND 60)) END, 0) END as ENTRE31Y60,
CASE WHEN IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 61 AND 90)  AND ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 61 AND 90)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 61 AND 90)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 61 AND 90)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 61 AND 90)  AND  (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM  Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta)) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 61 AND 90)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 61 AND 90)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 61 AND 90)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 61 AND 90)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 61 AND 90)  AND (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta) AND (DATEDIFF(Vence, @Hasta) * -1 BETWEEN 61 AND 90)) END, 0) < 0 THEN 0 ELSE IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 61 AND 90)  AND ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 61 AND 90)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 61 AND 90)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 61 AND 90)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 61 AND 90)  AND  (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM  Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta)) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 61 AND 90)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 61 AND 90)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 61 AND 90)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 61 AND 90)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 61 AND 90)  AND (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta) AND (DATEDIFF(Vence, @Hasta) * -1 BETWEEN 61 AND 90)) END, 0) END as ENTRE61Y90,
CASE WHEN IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 91 AND 120)  AND ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 91 AND 120)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 91 AND 120)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 91 AND 120)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 91 AND 120)  AND  (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM  Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta)) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 91 AND 120)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 91 AND 120)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 91 AND 120)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 91 AND 120)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 91 AND 120)  AND (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta) AND (DATEDIFF(Vence, @Hasta) * -1 BETWEEN 91 AND 120)) END, 0) < 0 THEN 0 ELSE IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 91 AND 120)  AND ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 91 AND 120)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 91 AND 120)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 91 AND 120)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 91 AND 120)  AND  (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM  Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta)) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 91 AND 120)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 91 AND 120)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 91 AND 120)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 91 AND 120)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 91 AND 120)  AND (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta) AND (DATEDIFF(Vence, @Hasta) * -1 BETWEEN 91 AND 120)) END, 0) END as ENTRE91Y120,
CASE WHEN IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 121 AND 150)  AND ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 121 AND 150)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 121 AND 150)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 121 AND 150)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 121 AND 150)  AND  (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM  Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta)) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 121 AND 150)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 121 AND 150)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 121 AND 150)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 121 AND 150)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 121 AND 150)  AND (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta) AND (DATEDIFF(Vence, @Hasta) * -1 BETWEEN 121 AND 150)) END, 0) < 0 THEN 0 ELSE IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 121 AND 150)  AND ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 121 AND 150)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 121 AND 150)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 121 AND 150)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 121 AND 150)  AND  (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM  Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta)) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 121 AND 150)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 121 AND 150)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 121 AND 150)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 121 AND 150)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 121 AND 150)  AND (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta) AND (DATEDIFF(Vence, @Hasta) * -1 BETWEEN 121 AND 150)) END, 0) END as ENTRE121Y150,
CASE WHEN IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 151 AND 180)  AND ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 151 AND 180)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 151 AND 180)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 151 AND 180)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 151 AND 180)  AND  (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM  Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta)) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 151 AND 180)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 151 AND 180)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 151 AND 180)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 151 AND 180)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 151 AND 180)  AND (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta) AND (DATEDIFF(Vence, @Hasta) * -1 BETWEEN 151 AND 180)) END, 0) < 0 THEN 0 ELSE IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 151 AND 180)  AND ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 151 AND 180)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 151 AND 180)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 151 AND 180)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 151 AND 180)  AND  (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM  Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta)) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 151 AND 180)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 151 AND 180)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 151 AND 180)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 151 AND 180)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 151 AND 180)  AND (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta) AND (DATEDIFF(Vence, @Hasta) * -1 BETWEEN 151 AND 180)) END, 0) END as ENTRE151Y180,
CASE WHEN IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 181 AND 210)  AND ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 181 AND 210)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 181 AND 210)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 181 AND 210)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 181 AND 210)  AND  (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM  Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta)) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 181 AND 210)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 181 AND 210)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 181 AND 210)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 181 AND 210)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 181 AND 210)  AND (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta) AND (DATEDIFF(Vence, @Hasta) * -1 BETWEEN 181 AND 210)) END, 0) < 0 THEN 0 ELSE IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 181 AND 210)  AND ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 181 AND 210)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 181 AND 210)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 181 AND 210)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 181 AND 210)  AND  (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM  Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta)) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 181 AND 210)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 181 AND 210)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 181 AND 210)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 181 AND 210)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 181 AND 210)  AND (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta) AND (DATEDIFF(Vence, @Hasta) * -1 BETWEEN 181 AND 210)) END, 0) END as ENTRE181Y210,
CASE WHEN IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 211 AND 240)  AND ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 211 AND 240)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 211 AND 240)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 211 AND 240)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 211 AND 240)  AND  (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM  Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta)) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 211 AND 240)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 211 AND 240)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 211 AND 240)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 211 AND 240)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 211 AND 240)  AND (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta) AND (DATEDIFF(Vence, @Hasta) * -1 BETWEEN 211 AND 240)) END, 0) < 0 THEN 0 ELSE IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 211 AND 240)  AND ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 211 AND 240)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 211 AND 240)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 211 AND 240)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 211 AND 240)  AND  (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM  Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta)) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 211 AND 240)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 211 AND 240)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 211 AND 240)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 211 AND 240)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 211 AND 240)  AND (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta) AND (DATEDIFF(Vence, @Hasta) * -1 BETWEEN 211 AND 240)) END, 0) END as ENTRE211Y240,
CASE WHEN IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 241 AND 270)  AND ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 241 AND 270)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 241 AND 270)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 241 AND 270)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 241 AND 270)  AND  (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM  Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta)) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 241 AND 270)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 241 AND 270)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 241 AND 270)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 241 AND 270)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 241 AND 270)  AND (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta) AND (DATEDIFF(Vence, @Hasta) * -1 BETWEEN 241 AND 270)) END, 0) < 0 THEN 0 ELSE IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 241 AND 270)  AND ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 241 AND 270)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 241 AND 270)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 241 AND 270)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 241 AND 270)  AND  (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM  Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta)) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 241 AND 270)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 241 AND 270)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 241 AND 270)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 241 AND 270)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 241 AND 270)  AND (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta) AND (DATEDIFF(Vence, @Hasta) * -1 BETWEEN 241 AND 270)) END, 0) END as ENTRE241Y270,
CASE WHEN IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 > 270)  AND ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 > 270)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 > 270)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 > 270)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 > 270)  AND  (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM  Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta)) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 > 270)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 > 270)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 > 270)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 > 270)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 > 270)  AND (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta) AND (DATEDIFF(Vence, @Hasta) * -1 > 270)) END, 0) < 0 THEN 0 ELSE IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 > 270)  AND ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 > 270)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 > 270)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 > 270)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 > 270)  AND  (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM  Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta)) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 > 270)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 > 270)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 > 270)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 > 270)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 > 270)  AND (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta) AND (DATEDIFF(Vence, @Hasta) * -1 > 270)) END, 0) END as MAS270,

		
CASE WHEN Solicitudes.Monto + Solicitudes.Monto * Contratos.Comision / 100 * Solicitudes.Tiempo  + (Solicitudes.Monto * Contratos.Interes / 100 * Solicitudes.Tiempo) >	IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.ContratoID = Contratos.ContratoID)), 0) THEN IFNULL((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.ContratoID = Contratos.ContratoID)), 0)								 
ELSE
Solicitudes.Monto + Solicitudes.Monto * Contratos.Comision / 100 * Solicitudes.Tiempo  + (Solicitudes.Monto * Contratos.Interes / 100 * Solicitudes.Tiempo) 					 
END AS Pagado,

(SELECT Fecha FROM Recibos AS R WHERE (ContratoID = Contratos.ContratoID) AND (EstadoID = 1) ORDER BY ReciboID DESC Limit 1) AS FechaUltimoPago,
(SELECT Monto FROM Recibos AS R WHERE (ContratoID = Contratos.ContratoID) AND (EstadoID = 1) ORDER BY ReciboID DESC Limit 1) AS MontoUltimoPago,			   

1 AS Deudor, 
CASE WHEN Solicitudes.TipoSolicitudID = 2 THEN 'H' WHEN Solicitudes.TipoSolicitudID = 4 THEN 'C' WHEN Solicitudes.TipoSolicitudID = 5 THEN 'M' ELSE 'N' END AS Tipo,

CASE
WHEN CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM  DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM  Cuotas AS c11 WHERE ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM  DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM  Cuotas AS c11 WHERE   ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM  DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM  Cuotas AS c11 WHERE ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT  SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM  Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (ContratoID = Contratos.ContratoID)))), 0) AS Balance FROM  Cuotas AS C WHERE (ContratoID = Contratos.ContratoID)) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (ContratoID = Contratos.ContratoID)))), 0) AS Balance FROM Cuotas AS C WHERE (ContratoID = Contratos.ContratoID)) END <= 10 THEN 'S' 
WHEN CASE WHEN CASE WHEN ( SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) < 1 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) < 1 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (Vence <= @Hasta) AND (ContratoID = Contratos.ContratoID)))), 0) AS Balance FROM Cuotas AS C WHERE (ContratoID = Contratos.ContratoID)) < 1 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) < 1 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM  Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) < 1 THEN 0 ELSE  (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (Vence <= @Hasta) AND (ContratoID = Contratos.ContratoID)))), 0) AS Balance FROM Cuotas AS C WHERE (ContratoID = Contratos.ContratoID)) END < 1 THEN 0 ELSE (SELECT COUNT(CuotaID) AS Cantidad FROM Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta) AND (Capital + Comision + Interes + Mora + Legal + Seguro + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID = C.CuotaID)) < 1 THEN 0 ELSE  (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID = C.CuotaID)) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaDebitos AS ND WHERE (CuotaID = C.CuotaID)) < 1 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID = C.CuotaID)) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (DR.CuotaID = C.CuotaID)), 0) > 1)) END < 1 THEN 'N'
WHEN CASE WHEN CASE WHEN ( SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) < 1 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) < 1 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (Vence <= @Hasta) AND (ContratoID = Contratos.ContratoID)))), 0) AS Balance FROM Cuotas AS C WHERE (ContratoID = Contratos.ContratoID)) < 1 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) < 1 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM  Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) < 1 THEN 0 ELSE  (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (Vence <= @Hasta) AND (ContratoID = Contratos.ContratoID)))), 0) AS Balance FROM Cuotas AS C WHERE (ContratoID = Contratos.ContratoID)) END < 1 THEN 0 ELSE (SELECT COUNT(CuotaID) AS Cantidad FROM Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta) AND (Capital + Comision + Interes + Mora + Legal + Seguro + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID = C.CuotaID)) < 1 THEN 0 ELSE  (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID = C.CuotaID)) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaDebitos AS ND WHERE (CuotaID = C.CuotaID)) < 1 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID = C.CuotaID)) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (DR.CuotaID = C.CuotaID)), 0) > 1)) END <= 3 THEN 'M'
WHEN CASE WHEN CASE WHEN ( SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) < 1 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) < 1 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (Vence <= @Hasta) AND (ContratoID = Contratos.ContratoID)))), 0) AS Balance FROM Cuotas AS C WHERE (ContratoID = Contratos.ContratoID)) < 1 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) < 1 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM  Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) < 1 THEN 0 ELSE  (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (Vence <= @Hasta) AND (ContratoID = Contratos.ContratoID)))), 0) AS Balance FROM Cuotas AS C WHERE (ContratoID = Contratos.ContratoID)) END < 1 THEN 0 ELSE (SELECT COUNT(CuotaID) AS Cantidad FROM Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta) AND (Capital + Comision + Interes + Mora + Legal + Seguro + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID = C.CuotaID)) < 1 THEN 0 ELSE  (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID = C.CuotaID)) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaDebitos AS ND WHERE (CuotaID = C.CuotaID)) < 1 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID = C.CuotaID)) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (DR.CuotaID = C.CuotaID)), 0) > 1)) END <= 5 THEN 'L' ELSE 'C' END AS Status


FROM            Contratos INNER JOIN
                         Solicitudes ON Contratos.SolicitudID = Solicitudes.SolicitudID INNER JOIN
                         Clientes ON Solicitudes.ClienteID = Clientes.ClienteID INNER JOIN
                         Personas ON Clientes.Documento = Personas.Documento INNER JOIN
                         Condiciones ON Solicitudes.CondicionID = Condiciones.CondicionID INNER JOIN
                         Ciudades ON Ciudades.CiudadID = Personas.CiudadID INNER JOIN
                         Provincias ON Provincias.ProvinciaID = Ciudades.ProvinciaID INNER JOIN
						 Paises ON Provincias.PaisID = Paises.PaisID INNER JOIN
                         TipoContratos ON Contratos.TipoContratoID = TipoContratos.TipoContratoID INNER JOIN
                         Sucursales ON Clientes.SucursalID = Sucursales.SucursalID INNER JOIN 
                         Sexos ON Personas.SexoID = Sexos.SexoID INNER JOIN 
                         EstadosCiviles on Personas.EstadoCivilID = EstadosCiviles.EstadoCivilID LEFT OUTER JOIN
                         DatosEconomicos on Personas.Documento = DatosEconomicos.Documento INNER JOIN
                         Ocupaciones on DatosEconomicos.OcupacionID = Ocupaciones.OcupacionID INNER JOIN
                         Instituciones on DatosEconomicos.InstitucionID = Instituciones.InstitucionID INNER JOIN
                         Zonas on Contratos.ZonaID = Zonas.ZonaID
WHERE        (Contratos.EstadoID >= 2) AND (Contratos.Fecha <= @Hasta) AND (Contratos.DataCredito = 1) AND (DATEDIFF(@Hasta, (SELECT Fecha FROM Recibos AS R WHERE (ContratoID = Contratos.ContratoID) AND (EstadoID = 1) ORDER BY ReciboID DESC Limit 1)) <= 60)

UNION ALL /*GARANTES ACTIVOS*/

SELECT 'P' as Tipoentidad, Contratos.ContratoID, Contratos.Fecha, Contratos.Vence, Personas.FechaNacimiento, Personas.Documento, Personas.Nombres, Personas.Apellidos, CONCAT(Personas.Nombres, ' ', Personas.Apellidos) AS Cliente, Personas.Direccion, Personas.Correo, 
Personas.Telefono, Personas.Celular, Ciudades.Ciudad, Provincias.Provincia, CASE WHEN Condiciones.CondicionID = 1 THEN 'MENSUAL' WHEN Condiciones.CondicionID = 2 THEN 'QUINCENAL' WHEN Condiciones.CondicionID = 3 THEN 'SEMANAL' ELSE 'DIARIO' END AS Condicion, TipoContratos.TipoContrato,  CASE WHEN Sexos.SexoID = 1 THEN 'M' ELSE 'F' END as Sexo, CASE WHEN Personas.EstadoCivilID = 1 then 'S' else 'C' end as EstadoCivil, Ocupaciones.Ocupacion, Solicitudes.ClienteID, Paises.Pais, Paises.Nacionalidad, Provincias.Provincia, Contratos.Interes, Solicitudes.Tiempo, Contratos.EstadoID,
round( Solicitudes.Monto +   Solicitudes.Monto * (((Contratos.Comision) / 100) * (Solicitudes.Tiempo / Condiciones.Meses)),0) AS Monto, Contratos.Cuota,  Instituciones.Institucion, Instituciones.Direccion as DireccionInstitucion, Instituciones.Telefono as TelefonoInstitucion,

CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM  DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM  Cuotas AS c11 WHERE ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM  DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM  Cuotas AS c11 WHERE   ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN
(SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM  DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE  ContratoID = Contratos.ContratoID))) < 0 THEN 0
ELSE
(SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM  Cuotas AS c11 WHERE ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT  SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM  Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (ContratoID = Contratos.ContratoID)))), 0) AS Balance FROM  Cuotas AS C WHERE (ContratoID = Contratos.ContratoID)) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (ContratoID = Contratos.ContratoID)))), 0) AS Balance FROM Cuotas AS C WHERE (ContratoID = Contratos.ContratoID))
END as Balance,

CASE WHEN CASE WHEN ( SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) < 1 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) < 1 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (Vence <= @Hasta) AND (ContratoID = Contratos.ContratoID)))), 0) AS Balance FROM Cuotas AS C WHERE (ContratoID = Contratos.ContratoID)) < 1 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) < 1 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM  Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) < 1 THEN 0 ELSE  (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (Vence <= @Hasta) AND (ContratoID = Contratos.ContratoID)))), 0) AS Balance FROM Cuotas AS C WHERE (ContratoID = Contratos.ContratoID)) END < 1 THEN 0
ELSE
(SELECT COUNT(CuotaID) AS Cantidad FROM Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta) AND (Capital + Comision + Interes + Mora + Legal + Seguro + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID = C.CuotaID)) < 1 THEN 0 ELSE  (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID = C.CuotaID)) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaDebitos AS ND WHERE (CuotaID = C.CuotaID)) < 1 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID = C.CuotaID)) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (DR.CuotaID = C.CuotaID)), 0) > 1)) 
END AS Cantidad,
																 
								 
IFNULL(CASE WHEN
(SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (Vence <= @Hasta) AND (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta)) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (Vence <= @Hasta) AND (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta)) END, 0) 
AS Atraso,

CASE WHEN IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 0 AND 30)  AND ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 0 AND 30)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 0 AND 30)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 0 AND 30)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 0 AND 30)  AND  (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM  Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta)) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 0 AND 30)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 0 AND 30)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 0 AND 30)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 0 AND 30)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 0 AND 30)  AND (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta) AND (DATEDIFF(Vence, @Hasta) * -1 BETWEEN 0 AND 30)) END, 0) < 0 THEN 0 ELSE IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 0 AND 30)  AND ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 0 AND 30)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 0 AND 30)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 0 AND 30)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 0 AND 30)  AND  (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM  Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta)) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 0 AND 30)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 0 AND 30)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 0 AND 30)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 0 AND 30)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 0 AND 30)  AND (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta) AND (DATEDIFF(Vence, @Hasta) * -1 BETWEEN 0 AND 30)) END, 0) END as ENTRE0Y30,
CASE WHEN IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 31 AND 60)  AND ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 31 AND 60)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 31 AND 60)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 31 AND 60)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 31 AND 60)  AND  (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM  Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta)) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 31 AND 60)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 31 AND 60)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 31 AND 60)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 31 AND 60)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 31 AND 60)  AND (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta) AND (DATEDIFF(Vence, @Hasta) * -1 BETWEEN 31 AND 60)) END, 0) < 0 THEN 0 ELSE IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 31 AND 60)  AND ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 31 AND 60)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 31 AND 60)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 31 AND 60)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 31 AND 60)  AND  (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM  Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta)) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 31 AND 60)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 31 AND 60)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 31 AND 60)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 31 AND 60)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 31 AND 60)  AND (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta) AND (DATEDIFF(Vence, @Hasta) * -1 BETWEEN 31 AND 60)) END, 0) END as ENTRE31Y60,
CASE WHEN IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 61 AND 90)  AND ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 61 AND 90)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 61 AND 90)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 61 AND 90)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 61 AND 90)  AND  (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM  Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta)) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 61 AND 90)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 61 AND 90)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 61 AND 90)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 61 AND 90)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 61 AND 90)  AND (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta) AND (DATEDIFF(Vence, @Hasta) * -1 BETWEEN 61 AND 90)) END, 0) < 0 THEN 0 ELSE IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 61 AND 90)  AND ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 61 AND 90)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 61 AND 90)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 61 AND 90)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 61 AND 90)  AND  (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM  Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta)) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 61 AND 90)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 61 AND 90)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 61 AND 90)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 61 AND 90)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 61 AND 90)  AND (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta) AND (DATEDIFF(Vence, @Hasta) * -1 BETWEEN 61 AND 90)) END, 0) END as ENTRE61Y90,
CASE WHEN IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 91 AND 120)  AND ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 91 AND 120)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 91 AND 120)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 91 AND 120)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 91 AND 120)  AND  (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM  Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta)) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 91 AND 120)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 91 AND 120)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 91 AND 120)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 91 AND 120)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 91 AND 120)  AND (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta) AND (DATEDIFF(Vence, @Hasta) * -1 BETWEEN 91 AND 120)) END, 0) < 0 THEN 0 ELSE IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 91 AND 120)  AND ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 91 AND 120)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 91 AND 120)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 91 AND 120)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 91 AND 120)  AND  (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM  Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta)) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 91 AND 120)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 91 AND 120)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 91 AND 120)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 91 AND 120)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 91 AND 120)  AND (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta) AND (DATEDIFF(Vence, @Hasta) * -1 BETWEEN 91 AND 120)) END, 0) END as ENTRE91Y120,
CASE WHEN IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 121 AND 150)  AND ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 121 AND 150)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 121 AND 150)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 121 AND 150)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 121 AND 150)  AND  (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM  Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta)) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 121 AND 150)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 121 AND 150)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 121 AND 150)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 121 AND 150)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 121 AND 150)  AND (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta) AND (DATEDIFF(Vence, @Hasta) * -1 BETWEEN 121 AND 150)) END, 0) < 0 THEN 0 ELSE IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 121 AND 150)  AND ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 121 AND 150)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 121 AND 150)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 121 AND 150)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 121 AND 150)  AND  (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM  Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta)) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 121 AND 150)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 121 AND 150)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 121 AND 150)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 121 AND 150)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 121 AND 150)  AND (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta) AND (DATEDIFF(Vence, @Hasta) * -1 BETWEEN 121 AND 150)) END, 0) END as ENTRE121Y150,
CASE WHEN IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 151 AND 180)  AND ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 151 AND 180)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 151 AND 180)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 151 AND 180)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 151 AND 180)  AND  (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM  Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta)) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 151 AND 180)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 151 AND 180)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 151 AND 180)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 151 AND 180)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 151 AND 180)  AND (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta) AND (DATEDIFF(Vence, @Hasta) * -1 BETWEEN 151 AND 180)) END, 0) < 0 THEN 0 ELSE IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 151 AND 180)  AND ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 151 AND 180)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 151 AND 180)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 151 AND 180)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 151 AND 180)  AND  (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM  Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta)) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 151 AND 180)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 151 AND 180)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 151 AND 180)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 151 AND 180)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 151 AND 180)  AND (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta) AND (DATEDIFF(Vence, @Hasta) * -1 BETWEEN 151 AND 180)) END, 0) END as ENTRE151Y180,
CASE WHEN IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 181 AND 210)  AND ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 181 AND 210)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 181 AND 210)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 181 AND 210)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 181 AND 210)  AND  (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM  Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta)) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 181 AND 210)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 181 AND 210)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 181 AND 210)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 181 AND 210)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 181 AND 210)  AND (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta) AND (DATEDIFF(Vence, @Hasta) * -1 BETWEEN 181 AND 210)) END, 0) < 0 THEN 0 ELSE IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 181 AND 210)  AND ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 181 AND 210)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 181 AND 210)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 181 AND 210)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 181 AND 210)  AND  (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM  Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta)) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 181 AND 210)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 181 AND 210)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 181 AND 210)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 181 AND 210)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 181 AND 210)  AND (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta) AND (DATEDIFF(Vence, @Hasta) * -1 BETWEEN 181 AND 210)) END, 0) END as ENTRE181Y210,
CASE WHEN IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 211 AND 240)  AND ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 211 AND 240)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 211 AND 240)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 211 AND 240)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 211 AND 240)  AND  (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM  Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta)) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 211 AND 240)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 211 AND 240)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 211 AND 240)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 211 AND 240)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 211 AND 240)  AND (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta) AND (DATEDIFF(Vence, @Hasta) * -1 BETWEEN 211 AND 240)) END, 0) < 0 THEN 0 ELSE IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 211 AND 240)  AND ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 211 AND 240)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 211 AND 240)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 211 AND 240)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 211 AND 240)  AND  (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM  Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta)) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 211 AND 240)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 211 AND 240)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 211 AND 240)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 211 AND 240)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 211 AND 240)  AND (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta) AND (DATEDIFF(Vence, @Hasta) * -1 BETWEEN 211 AND 240)) END, 0) END as ENTRE211Y240,
CASE WHEN IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 241 AND 270)  AND ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 241 AND 270)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 241 AND 270)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 241 AND 270)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 241 AND 270)  AND  (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM  Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta)) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 241 AND 270)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 241 AND 270)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 241 AND 270)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 241 AND 270)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 241 AND 270)  AND (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta) AND (DATEDIFF(Vence, @Hasta) * -1 BETWEEN 241 AND 270)) END, 0) < 0 THEN 0 ELSE IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 241 AND 270)  AND ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 241 AND 270)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 241 AND 270)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 241 AND 270)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 241 AND 270)  AND  (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM  Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta)) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 241 AND 270)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 241 AND 270)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 241 AND 270)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 241 AND 270)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 241 AND 270)  AND (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta) AND (DATEDIFF(Vence, @Hasta) * -1 BETWEEN 241 AND 270)) END, 0) END as ENTRE241Y270,
CASE WHEN IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 > 270)  AND ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 > 270)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 > 270)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 > 270)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 > 270)  AND  (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM  Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta)) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 > 270)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 > 270)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 > 270)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 > 270)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 > 270)  AND (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta) AND (DATEDIFF(Vence, @Hasta) * -1 > 270)) END, 0) < 0 THEN 0 ELSE IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 > 270)  AND ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 > 270)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 > 270)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 > 270)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 > 270)  AND  (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM  Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta)) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 > 270)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 > 270)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 > 270)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 > 270)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 > 270)  AND (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta) AND (DATEDIFF(Vence, @Hasta) * -1 > 270)) END, 0) END as MAS270,

		
CASE WHEN Solicitudes.Monto + Solicitudes.Monto * Contratos.Comision / 100 * Solicitudes.Tiempo  + (Solicitudes.Monto * Contratos.Interes / 100 * Solicitudes.Tiempo) >	IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.ContratoID = Contratos.ContratoID)), 0) THEN IFNULL((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.ContratoID = Contratos.ContratoID)), 0)								 
ELSE
Solicitudes.Monto + Solicitudes.Monto * Contratos.Comision / 100 * Solicitudes.Tiempo  + (Solicitudes.Monto * Contratos.Interes / 100 * Solicitudes.Tiempo) 					 
END AS Pagado,

(SELECT Fecha FROM Recibos AS R WHERE (ContratoID = Contratos.ContratoID) AND (EstadoID = 1) ORDER BY ReciboID DESC Limit 1) AS FechaUltimoPago,
(SELECT Monto FROM Recibos AS R WHERE (ContratoID = Contratos.ContratoID) AND (EstadoID = 1) ORDER BY ReciboID DESC Limit 1) AS MontoUltimoPago,			   

2 AS Deudor, 
CASE WHEN Solicitudes.TipoSolicitudID = 2 THEN 'H' WHEN Solicitudes.TipoSolicitudID = 4 THEN 'C' WHEN Solicitudes.TipoSolicitudID = 5 THEN 'M' ELSE 'N' END AS Tipo,

CASE
WHEN CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM  DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM  Cuotas AS c11 WHERE ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM  DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM  Cuotas AS c11 WHERE   ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM  DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM  Cuotas AS c11 WHERE ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT  SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM  Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (ContratoID = Contratos.ContratoID)))), 0) AS Balance FROM  Cuotas AS C WHERE (ContratoID = Contratos.ContratoID)) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (ContratoID = Contratos.ContratoID)))), 0) AS Balance FROM Cuotas AS C WHERE (ContratoID = Contratos.ContratoID)) END <= 10 THEN 'S' 
WHEN CASE WHEN CASE WHEN ( SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) < 1 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) < 1 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (Vence <= @Hasta) AND (ContratoID = Contratos.ContratoID)))), 0) AS Balance FROM Cuotas AS C WHERE (ContratoID = Contratos.ContratoID)) < 1 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) < 1 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM  Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) < 1 THEN 0 ELSE  (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (Vence <= @Hasta) AND (ContratoID = Contratos.ContratoID)))), 0) AS Balance FROM Cuotas AS C WHERE (ContratoID = Contratos.ContratoID)) END < 1 THEN 0 ELSE (SELECT COUNT(CuotaID) AS Cantidad FROM Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta) AND (Capital + Comision + Interes + Mora + Legal + Seguro + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID = C.CuotaID)) < 1 THEN 0 ELSE  (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID = C.CuotaID)) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaDebitos AS ND WHERE (CuotaID = C.CuotaID)) < 1 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID = C.CuotaID)) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (DR.CuotaID = C.CuotaID)), 0) > 1)) END < 1 THEN 'N'
WHEN CASE WHEN CASE WHEN ( SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) < 1 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) < 1 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (Vence <= @Hasta) AND (ContratoID = Contratos.ContratoID)))), 0) AS Balance FROM Cuotas AS C WHERE (ContratoID = Contratos.ContratoID)) < 1 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) < 1 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM  Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) < 1 THEN 0 ELSE  (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (Vence <= @Hasta) AND (ContratoID = Contratos.ContratoID)))), 0) AS Balance FROM Cuotas AS C WHERE (ContratoID = Contratos.ContratoID)) END < 1 THEN 0 ELSE (SELECT COUNT(CuotaID) AS Cantidad FROM Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta) AND (Capital + Comision + Interes + Mora + Legal + Seguro + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID = C.CuotaID)) < 1 THEN 0 ELSE  (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID = C.CuotaID)) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaDebitos AS ND WHERE (CuotaID = C.CuotaID)) < 1 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID = C.CuotaID)) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (DR.CuotaID = C.CuotaID)), 0) > 1)) END <= 3 THEN 'M'
WHEN CASE WHEN CASE WHEN ( SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) < 1 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) < 1 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (Vence <= @Hasta) AND (ContratoID = Contratos.ContratoID)))), 0) AS Balance FROM Cuotas AS C WHERE (ContratoID = Contratos.ContratoID)) < 1 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) < 1 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM  Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) < 1 THEN 0 ELSE  (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (Vence <= @Hasta) AND (ContratoID = Contratos.ContratoID)))), 0) AS Balance FROM Cuotas AS C WHERE (ContratoID = Contratos.ContratoID)) END < 1 THEN 0 ELSE (SELECT COUNT(CuotaID) AS Cantidad FROM Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta) AND (Capital + Comision + Interes + Mora + Legal + Seguro + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID = C.CuotaID)) < 1 THEN 0 ELSE  (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID = C.CuotaID)) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaDebitos AS ND WHERE (CuotaID = C.CuotaID)) < 1 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID = C.CuotaID)) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (DR.CuotaID = C.CuotaID)), 0) > 1)) END <= 5 THEN 'L' ELSE 'C' END AS Status


FROM            Contratos INNER JOIN
                         Solicitudes ON Contratos.SolicitudID = Solicitudes.SolicitudID INNER JOIN
                         GarantiaPersonal ON Solicitudes.SolicitudID = GarantiaPersonal.SolicitudID INNER JOIN
                         Personas ON GarantiaPersonal.Documento = Personas.Documento INNER JOIN
                         Condiciones ON Solicitudes.CondicionID = Condiciones.CondicionID INNER JOIN
                         Ciudades ON Ciudades.CiudadID = Personas.CiudadID INNER JOIN
                         Provincias ON Provincias.ProvinciaID = Ciudades.ProvinciaID INNER JOIN
						 Paises ON Provincias.PaisID = Paises.PaisID INNER JOIN
                         TipoContratos ON Contratos.TipoContratoID = TipoContratos.TipoContratoID INNER JOIN
                         Clientes ON Clientes.ClienteID = Solicitudes.ClienteID INNER JOIN
                         Sucursales ON Clientes.SucursalID = Sucursales.SucursalID INNER JOIN 
                         Sexos ON Personas.SexoID = Sexos.SexoID INNER JOIN 
                         EstadosCiviles on Personas.EstadoCivilID = EstadosCiviles.EstadoCivilID LEFT OUTER JOIN
                         DatosEconomicos on Personas.Documento = DatosEconomicos.Documento INNER JOIN
                         Ocupaciones on DatosEconomicos.OcupacionID = Ocupaciones.OcupacionID INNER JOIN
                         Instituciones on DatosEconomicos.InstitucionID = Instituciones.InstitucionID INNER JOIN
                         Zonas on Contratos.ZonaID = Zonas.ZonaID
WHERE        (Contratos.EstadoID = 1) AND (Contratos.Fecha <= @Hasta) AND (Contratos.DataCredito = 1)


UNION ALL /*GARANTES SALDOS*/

SELECT 'P' as Tipoentidad, Contratos.ContratoID, Contratos.Fecha, Contratos.Vence, Personas.FechaNacimiento, Personas.Documento, Personas.Nombres, Personas.Apellidos, CONCAT(Personas.Nombres, ' ', Personas.Apellidos) AS Cliente, Personas.Direccion, Personas.Correo, 
Personas.Telefono, Personas.Celular, Ciudades.Ciudad, Provincias.Provincia, CASE WHEN Condiciones.CondicionID = 1 THEN 'MENSUAL' WHEN Condiciones.CondicionID = 2 THEN 'QUINCENAL' WHEN Condiciones.CondicionID = 3 THEN 'SEMANAL' ELSE 'DIARIO' END AS Condicion, TipoContratos.TipoContrato,  CASE WHEN Sexos.SexoID = 1 THEN 'M' ELSE 'F' END as Sexo, CASE WHEN Personas.EstadoCivilID = 1 then 'S' else 'C' end as EstadoCivil, Ocupaciones.Ocupacion, Solicitudes.ClienteID, Paises.Pais, Paises.Nacionalidad, Provincias.Provincia, Contratos.Interes, Solicitudes.Tiempo, Contratos.EstadoID,
round( Solicitudes.Monto +   Solicitudes.Monto * (((Contratos.Comision) / 100) * (Solicitudes.Tiempo / Condiciones.Meses)),0) AS Monto, Contratos.Cuota, Instituciones.Institucion, Instituciones.Direccion as DireccionInstitucion, Instituciones.Telefono as TelefonoInstitucion,

CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM  DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM  Cuotas AS c11 WHERE ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM  DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM  Cuotas AS c11 WHERE   ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN
(SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM  DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE  ContratoID = Contratos.ContratoID))) < 0 THEN 0
ELSE
(SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM  Cuotas AS c11 WHERE ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT  SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM  Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (ContratoID = Contratos.ContratoID)))), 0) AS Balance FROM  Cuotas AS C WHERE (ContratoID = Contratos.ContratoID)) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (ContratoID = Contratos.ContratoID)))), 0) AS Balance FROM Cuotas AS C WHERE (ContratoID = Contratos.ContratoID))
END as Balance,

CASE WHEN CASE WHEN ( SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) < 1 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) < 1 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (Vence <= @Hasta) AND (ContratoID = Contratos.ContratoID)))), 0) AS Balance FROM Cuotas AS C WHERE (ContratoID = Contratos.ContratoID)) < 1 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) < 1 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM  Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) < 1 THEN 0 ELSE  (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (Vence <= @Hasta) AND (ContratoID = Contratos.ContratoID)))), 0) AS Balance FROM Cuotas AS C WHERE (ContratoID = Contratos.ContratoID)) END < 1 THEN 0
ELSE
(SELECT COUNT(CuotaID) AS Cantidad FROM Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta) AND (Capital + Comision + Interes + Mora + Legal + Seguro + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID = C.CuotaID)) < 1 THEN 0 ELSE  (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID = C.CuotaID)) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaDebitos AS ND WHERE (CuotaID = C.CuotaID)) < 1 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID = C.CuotaID)) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (DR.CuotaID = C.CuotaID)), 0) > 1)) 
END AS Cantidad,
																 
								 
IFNULL(CASE WHEN
(SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (Vence <= @Hasta) AND (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta)) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (Vence <= @Hasta) AND (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta)) END, 0) 
AS Atraso,

CASE WHEN IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 0 AND 30)  AND ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 0 AND 30)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 0 AND 30)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 0 AND 30)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 0 AND 30)  AND  (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM  Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta)) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 0 AND 30)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 0 AND 30)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 0 AND 30)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 0 AND 30)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 0 AND 30)  AND (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta) AND (DATEDIFF(Vence, @Hasta) * -1 BETWEEN 0 AND 30)) END, 0) < 0 THEN 0 ELSE IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 0 AND 30)  AND ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 0 AND 30)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 0 AND 30)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 0 AND 30)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 0 AND 30)  AND  (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM  Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta)) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 0 AND 30)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 0 AND 30)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 0 AND 30)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 0 AND 30)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 0 AND 30)  AND (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta) AND (DATEDIFF(Vence, @Hasta) * -1 BETWEEN 0 AND 30)) END, 0) END as ENTRE0Y30,
CASE WHEN IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 31 AND 60)  AND ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 31 AND 60)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 31 AND 60)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 31 AND 60)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 31 AND 60)  AND  (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM  Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta)) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 31 AND 60)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 31 AND 60)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 31 AND 60)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 31 AND 60)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 31 AND 60)  AND (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta) AND (DATEDIFF(Vence, @Hasta) * -1 BETWEEN 31 AND 60)) END, 0) < 0 THEN 0 ELSE IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 31 AND 60)  AND ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 31 AND 60)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 31 AND 60)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 31 AND 60)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 31 AND 60)  AND  (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM  Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta)) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 31 AND 60)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 31 AND 60)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 31 AND 60)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 31 AND 60)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 31 AND 60)  AND (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta) AND (DATEDIFF(Vence, @Hasta) * -1 BETWEEN 31 AND 60)) END, 0) END as ENTRE31Y60,
CASE WHEN IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 61 AND 90)  AND ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 61 AND 90)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 61 AND 90)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 61 AND 90)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 61 AND 90)  AND  (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM  Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta)) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 61 AND 90)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 61 AND 90)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 61 AND 90)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 61 AND 90)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 61 AND 90)  AND (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta) AND (DATEDIFF(Vence, @Hasta) * -1 BETWEEN 61 AND 90)) END, 0) < 0 THEN 0 ELSE IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 61 AND 90)  AND ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 61 AND 90)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 61 AND 90)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 61 AND 90)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 61 AND 90)  AND  (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM  Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta)) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 61 AND 90)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 61 AND 90)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 61 AND 90)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 61 AND 90)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 61 AND 90)  AND (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta) AND (DATEDIFF(Vence, @Hasta) * -1 BETWEEN 61 AND 90)) END, 0) END as ENTRE61Y90,
CASE WHEN IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 91 AND 120)  AND ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 91 AND 120)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 91 AND 120)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 91 AND 120)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 91 AND 120)  AND  (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM  Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta)) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 91 AND 120)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 91 AND 120)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 91 AND 120)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 91 AND 120)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 91 AND 120)  AND (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta) AND (DATEDIFF(Vence, @Hasta) * -1 BETWEEN 91 AND 120)) END, 0) < 0 THEN 0 ELSE IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 91 AND 120)  AND ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 91 AND 120)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 91 AND 120)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 91 AND 120)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 91 AND 120)  AND  (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM  Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta)) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 91 AND 120)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 91 AND 120)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 91 AND 120)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 91 AND 120)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 91 AND 120)  AND (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta) AND (DATEDIFF(Vence, @Hasta) * -1 BETWEEN 91 AND 120)) END, 0) END as ENTRE91Y120,
CASE WHEN IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 121 AND 150)  AND ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 121 AND 150)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 121 AND 150)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 121 AND 150)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 121 AND 150)  AND  (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM  Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta)) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 121 AND 150)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 121 AND 150)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 121 AND 150)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 121 AND 150)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 121 AND 150)  AND (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta) AND (DATEDIFF(Vence, @Hasta) * -1 BETWEEN 121 AND 150)) END, 0) < 0 THEN 0 ELSE IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 121 AND 150)  AND ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 121 AND 150)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 121 AND 150)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 121 AND 150)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 121 AND 150)  AND  (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM  Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta)) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 121 AND 150)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 121 AND 150)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 121 AND 150)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 121 AND 150)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 121 AND 150)  AND (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta) AND (DATEDIFF(Vence, @Hasta) * -1 BETWEEN 121 AND 150)) END, 0) END as ENTRE121Y150,
CASE WHEN IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 151 AND 180)  AND ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 151 AND 180)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 151 AND 180)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 151 AND 180)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 151 AND 180)  AND  (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM  Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta)) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 151 AND 180)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 151 AND 180)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 151 AND 180)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 151 AND 180)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 151 AND 180)  AND (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta) AND (DATEDIFF(Vence, @Hasta) * -1 BETWEEN 151 AND 180)) END, 0) < 0 THEN 0 ELSE IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 151 AND 180)  AND ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 151 AND 180)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 151 AND 180)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 151 AND 180)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 151 AND 180)  AND  (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM  Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta)) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 151 AND 180)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 151 AND 180)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 151 AND 180)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 151 AND 180)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 151 AND 180)  AND (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta) AND (DATEDIFF(Vence, @Hasta) * -1 BETWEEN 151 AND 180)) END, 0) END as ENTRE151Y180,
CASE WHEN IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 181 AND 210)  AND ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 181 AND 210)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 181 AND 210)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 181 AND 210)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 181 AND 210)  AND  (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM  Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta)) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 181 AND 210)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 181 AND 210)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 181 AND 210)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 181 AND 210)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 181 AND 210)  AND (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta) AND (DATEDIFF(Vence, @Hasta) * -1 BETWEEN 181 AND 210)) END, 0) < 0 THEN 0 ELSE IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 181 AND 210)  AND ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 181 AND 210)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 181 AND 210)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 181 AND 210)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 181 AND 210)  AND  (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM  Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta)) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 181 AND 210)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 181 AND 210)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 181 AND 210)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 181 AND 210)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 181 AND 210)  AND (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta) AND (DATEDIFF(Vence, @Hasta) * -1 BETWEEN 181 AND 210)) END, 0) END as ENTRE181Y210,
CASE WHEN IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 211 AND 240)  AND ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 211 AND 240)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 211 AND 240)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 211 AND 240)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 211 AND 240)  AND  (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM  Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta)) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 211 AND 240)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 211 AND 240)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 211 AND 240)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 211 AND 240)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 211 AND 240)  AND (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta) AND (DATEDIFF(Vence, @Hasta) * -1 BETWEEN 211 AND 240)) END, 0) < 0 THEN 0 ELSE IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 211 AND 240)  AND ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 211 AND 240)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 211 AND 240)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 211 AND 240)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 211 AND 240)  AND  (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM  Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta)) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 211 AND 240)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 211 AND 240)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 211 AND 240)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 211 AND 240)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 211 AND 240)  AND (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta) AND (DATEDIFF(Vence, @Hasta) * -1 BETWEEN 211 AND 240)) END, 0) END as ENTRE211Y240,
CASE WHEN IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 241 AND 270)  AND ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 241 AND 270)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 241 AND 270)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 241 AND 270)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 241 AND 270)  AND  (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM  Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta)) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 241 AND 270)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 241 AND 270)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 241 AND 270)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 241 AND 270)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 241 AND 270)  AND (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta) AND (DATEDIFF(Vence, @Hasta) * -1 BETWEEN 241 AND 270)) END, 0) < 0 THEN 0 ELSE IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 241 AND 270)  AND ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 241 AND 270)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 241 AND 270)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 241 AND 270)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 241 AND 270)  AND  (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM  Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta)) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 241 AND 270)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 241 AND 270)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 241 AND 270)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 241 AND 270)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 BETWEEN 241 AND 270)  AND (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta) AND (DATEDIFF(Vence, @Hasta) * -1 BETWEEN 241 AND 270)) END, 0) END as ENTRE241Y270,
CASE WHEN IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 > 270)  AND ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 > 270)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 > 270)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 > 270)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 > 270)  AND  (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM  Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta)) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 > 270)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 > 270)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 > 270)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 > 270)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 > 270)  AND (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta) AND (DATEDIFF(Vence, @Hasta) * -1 > 270)) END, 0) < 0 THEN 0 ELSE IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 > 270)  AND ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 > 270)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 > 270)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 > 270)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 > 270)  AND  (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM  Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta)) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 > 270)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 > 270)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 > 270)  AND  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 > 270)  AND  ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (c11.Vence <= @Hasta) AND (DATEDIFF(c11.Vence, @Hasta) * -1 > 270)  AND (ContratoID = Contratos.ContratoID)))), 0) AS Atraso FROM Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta) AND (DATEDIFF(Vence, @Hasta) * -1 > 270)) END, 0) END as MAS270,

		
CASE WHEN Solicitudes.Monto + Solicitudes.Monto * Contratos.Comision / 100 * Solicitudes.Tiempo  + (Solicitudes.Monto * Contratos.Interes / 100 * Solicitudes.Tiempo) >	IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.ContratoID = Contratos.ContratoID)), 0) THEN IFNULL((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.ContratoID = Contratos.ContratoID)), 0)								 
ELSE
Solicitudes.Monto + Solicitudes.Monto * Contratos.Comision / 100 * Solicitudes.Tiempo  + (Solicitudes.Monto * Contratos.Interes / 100 * Solicitudes.Tiempo) 					 
END AS Pagado,

(SELECT Fecha FROM Recibos AS R WHERE (ContratoID = Contratos.ContratoID) AND (EstadoID = 1) ORDER BY ReciboID DESC Limit 1) AS FechaUltimoPago,
(SELECT Monto FROM Recibos AS R WHERE (ContratoID = Contratos.ContratoID) AND (EstadoID = 1) ORDER BY ReciboID DESC Limit 1) AS MontoUltimoPago,			   

2 AS Deudor, 
CASE WHEN Solicitudes.TipoSolicitudID = 2 THEN 'H' WHEN Solicitudes.TipoSolicitudID = 4 THEN 'C' WHEN Solicitudes.TipoSolicitudID = 5 THEN 'M' ELSE 'N' END AS Tipo,

CASE
WHEN CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM  DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM  Cuotas AS c11 WHERE ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM  DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM  Cuotas AS c11 WHERE   ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM  DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE  ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM  Cuotas AS c11 WHERE ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT  SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM  Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (ContratoID = Contratos.ContratoID)))), 0) AS Balance FROM  Cuotas AS C WHERE (ContratoID = Contratos.ContratoID)) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE ContratoID = Contratos.ContratoID))) < 0 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (ContratoID = Contratos.ContratoID)))), 0) AS Balance FROM Cuotas AS C WHERE (ContratoID = Contratos.ContratoID)) END <= 10 THEN 'S' 
WHEN CASE WHEN CASE WHEN ( SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) < 1 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) < 1 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (Vence <= @Hasta) AND (ContratoID = Contratos.ContratoID)))), 0) AS Balance FROM Cuotas AS C WHERE (ContratoID = Contratos.ContratoID)) < 1 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) < 1 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM  Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) < 1 THEN 0 ELSE  (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (Vence <= @Hasta) AND (ContratoID = Contratos.ContratoID)))), 0) AS Balance FROM Cuotas AS C WHERE (ContratoID = Contratos.ContratoID)) END < 1 THEN 0 ELSE (SELECT COUNT(CuotaID) AS Cantidad FROM Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta) AND (Capital + Comision + Interes + Mora + Legal + Seguro + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID = C.CuotaID)) < 1 THEN 0 ELSE  (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID = C.CuotaID)) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaDebitos AS ND WHERE (CuotaID = C.CuotaID)) < 1 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID = C.CuotaID)) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (DR.CuotaID = C.CuotaID)), 0) > 1)) END < 1 THEN 'N'
WHEN CASE WHEN CASE WHEN ( SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) < 1 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) < 1 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (Vence <= @Hasta) AND (ContratoID = Contratos.ContratoID)))), 0) AS Balance FROM Cuotas AS C WHERE (ContratoID = Contratos.ContratoID)) < 1 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) < 1 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM  Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) < 1 THEN 0 ELSE  (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (Vence <= @Hasta) AND (ContratoID = Contratos.ContratoID)))), 0) AS Balance FROM Cuotas AS C WHERE (ContratoID = Contratos.ContratoID)) END < 1 THEN 0 ELSE (SELECT COUNT(CuotaID) AS Cantidad FROM Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta) AND (Capital + Comision + Interes + Mora + Legal + Seguro + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID = C.CuotaID)) < 1 THEN 0 ELSE  (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID = C.CuotaID)) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaDebitos AS ND WHERE (CuotaID = C.CuotaID)) < 1 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID = C.CuotaID)) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (DR.CuotaID = C.CuotaID)), 0) > 1)) END <= 3 THEN 'M'
WHEN CASE WHEN CASE WHEN ( SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) < 1 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) < 1 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (Vence <= @Hasta) AND (ContratoID = Contratos.ContratoID)))), 0) AS Balance FROM Cuotas AS C WHERE (ContratoID = Contratos.ContratoID)) < 1 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) < 1 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaCreditos AS ND WHERE (CuotaID IN (SELECT CuotaID FROM  Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) < 1 THEN 0 ELSE  (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE Vence <= @Hasta AND ContratoID = Contratos.ContratoID))) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (R.Fecha <= @Hasta) AND (DR.CuotaID IN (SELECT CuotaID FROM Cuotas AS c11 WHERE (Vence <= @Hasta) AND (ContratoID = Contratos.ContratoID)))), 0) AS Balance FROM Cuotas AS C WHERE (ContratoID = Contratos.ContratoID)) END < 1 THEN 0 ELSE (SELECT COUNT(CuotaID) AS Cantidad FROM Cuotas AS C WHERE (ContratoID = Contratos.ContratoID) AND (Vence <= @Hasta) AND (Capital + Comision + Interes + Mora + Legal + Seguro + IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS ND FROM DetalleNotaDebitos AS ND WHERE (CuotaID = C.CuotaID)) < 1 THEN 0 ELSE  (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaDebitos AS ND WHERE (CuotaID = C.CuotaID)) END, 0) - IFNULL(CASE WHEN (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS NC FROM DetalleNotaDebitos AS ND WHERE (CuotaID = C.CuotaID)) < 1 THEN 0 ELSE (SELECT SUM(Capital + Comision + Interes + Mora + Legal + Seguro) AS Expr1 FROM DetalleNotaCreditos AS NC WHERE (CuotaID = C.CuotaID)) END, 0) - IFNULL ((SELECT SUM(DR.Capital + DR.Comision + DR.Interes + DR.Mora + DR.Legal + DR.Seguro) AS Pagado FROM Recibos AS R INNER JOIN DetalleRecibos AS DR ON R.ReciboID = DR.ReciboID WHERE (R.EstadoID = 1) AND (DR.CuotaID = C.CuotaID)), 0) > 1)) END <= 5 THEN 'L' ELSE 'C' END AS Status


FROM            Contratos INNER JOIN
                         Solicitudes ON Contratos.SolicitudID = Solicitudes.SolicitudID INNER JOIN
                         GarantiaPersonal ON Solicitudes.SolicitudID = GarantiaPersonal.SolicitudID INNER JOIN
                         Personas ON GarantiaPersonal.Documento = Personas.Documento INNER JOIN
                         Condiciones ON Solicitudes.CondicionID = Condiciones.CondicionID INNER JOIN
                         Ciudades ON Ciudades.CiudadID = Personas.CiudadID INNER JOIN
                         Provincias ON Provincias.ProvinciaID = Ciudades.ProvinciaID INNER JOIN
						 Paises ON Provincias.PaisID = Paises.PaisID INNER JOIN
                         TipoContratos ON Contratos.TipoContratoID = TipoContratos.TipoContratoID INNER JOIN
                         Clientes ON Clientes.ClienteID = Solicitudes.ClienteID INNER JOIN
                         Sucursales ON Clientes.SucursalID = Sucursales.SucursalID INNER JOIN 
                         Sexos ON Personas.SexoID = Sexos.SexoID INNER JOIN 
                         EstadosCiviles on Personas.EstadoCivilID = EstadosCiviles.EstadoCivilID LEFT OUTER JOIN
                         DatosEconomicos on Personas.Documento = DatosEconomicos.Documento INNER JOIN
                         Ocupaciones on DatosEconomicos.OcupacionID = Ocupaciones.OcupacionID INNER JOIN
                         Instituciones on DatosEconomicos.InstitucionID = Instituciones.InstitucionID INNER JOIN
                         Zonas on Contratos.ZonaID = Zonas.ZonaID
						 WHERE (Contratos.EstadoID >= 2) AND (Contratos.Fecha <= @Hasta) AND (Contratos.DataCredito = 1) AND (DATEDIFF(@Hasta, (SELECT Fecha FROM Recibos AS R WHERE (ContratoID = Contratos.ContratoID) AND (EstadoID = 1) ORDER BY ReciboID DESC Limit 1)) <= 60)
